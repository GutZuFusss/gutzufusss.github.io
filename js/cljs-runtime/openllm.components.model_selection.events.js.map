{"version":3,"sources":["openllm/components/model_selection/events.cljs"],"mappings":";AASA,uBAAA,vBAACA,kMAEA,WAAKC,KAAKC;AAAV,AACE,0DAAA,nDAACC,8CAAMF,mKAGI,XACA,AAACG,1DACD,q/FAAA,2EAAA,hkGAACC;;AAMf,yDAAA,zDAACC,oNAEA,cAAAC,HAAKG;AAAL,AAAA,IAAAF,aAAAD;QAAA,AAAAE,4CAAAD,WAAA,IAAA,/DAASN;iBAAT,AAAAO,4CAAAD,WAAA,IAAA,xEAAWG;AAAX,AACE,IAAMC,KAAG,8FAAA,9FAACC,gDAAQC;IACZC,gBAAc,AAACC,+CAAON,GAAG,qIAAA,4EAAA,jNAACO,sMAAuBN;AADvD,6CAEMD,nBACA,AAACQ,sBAAW,GAAA,HAACN,oEAAgBD,pHAC7B,OAACO,yHAAW,GAAA,HAACN,iEAAc,AAACO,gBAAMJ;;AAE3C,yDAAA,zDAACT,+MAEA,cAAAc,HAAKV;AAAL,AAAA,IAAAW,aAAAD;QAAA,AAAAX,4CAAAY,WAAA,IAAA,/DAASnB;eAAT,AAAAO,4CAAAY,WAAA,IAAA,tEAAWC;AAAX,AACE,OAACJ,mBAASR,GAAG,qIAAA,yEAAA,9MAACO,iRAAsCK;;AAEvD,yDAAA,uFAAA,hJAACC,mOAEC,wDAAA,xDAACC,4OACF,WAAAC,SAAyCvB;AAAzC,AAAA,IAAAwB,aAAAD;IAAAC,iBAAA,AAAAC,4BAAAD;SAAA,AAAAE,4CAAAF,eAAA,hEAAahB;6BAAb,AAAAkB,4CAAAF,eAAA,pFAAgBG;AAAhB,AAAA,kDAAA,gDACO,iBAAMC,aAAW,AAACF,4CAAIlB,GAAG,qIAAA,rIAACO;AAA1B,AACE,GAAI,EAAI,AAACc,6CAAEC,mDAAgBF,iBAAY,eAAA,dAAMA;AAC3C,OAACZ,mBAASR,GAAG,qIAAA,rIAACO,4MAAwBY;;AACtC,AAAI,mEAAA,uGAAA,1KAACI,6PAA6FH;;AAC9FpB","names":["re-frame.core/reg-cofx","cofx","_","cljs.core.assoc","js/JSON.parse","cljs.core.js__GT_clj","re_frame.core.reg_event_db","p__29449","vec__29450","cljs.core.nth","db","model-type","ks","cljs.core.partial","openllm.components.model-selection.db/key-seq","all-model-ids","cljs.core.get_in","openllm.components.model_selection.db.key_seq","cljs.core/assoc-in","cljs.core/first","p__29453","vec__29454","model-id","re_frame.core.reg_event_fx","re_frame.core.inject_cofx","p__29457","map__29458","cljs.core/--destructure-map","cljs.core.get","model-data-json-parsed","all-models","cljs.core._EQ_","openllm.components.model-selection.db/loading-text","openllm.api.log4cljs.core.log"],"sourcesContent":["(ns openllm.components.model-selection.events\n  (:require [openllm.components.model-selection.db :as db]\n            [openllm.api.log4cljs.core :refer [log]]\n            [re-frame.core :refer [reg-event-db reg-event-fx reg-cofx inject-cofx]])\n  (:require-macros [openllm.build :refer [slurp]]))\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n;;             Coeffects              ;;\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n(reg-cofx\n ::model-data-json-parsed\n (fn [cofx _]\n   (assoc cofx\n          :model-data-json-parsed\n          (-> \"./src/generated/models-data.json\"\n              (slurp ,) ;; see `openllm.build/slurp` to see how this sorcery works\n              (js/JSON.parse ,)\n              (js->clj , :keywordize-keys true)))))\n\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n;;               Events               ;;\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n(reg-event-db\n ::set-model-type\n (fn [db [_ model-type]] \n   (let [ks (partial db/key-seq :selected-model)\n         all-model-ids (get-in db (db/key-seq :all-models model-type :model_id))]\n     (-> db\n         (assoc-in , (ks :model-type) model-type)\n         (assoc-in , (ks :model-id) (first all-model-ids))))))\n\n(reg-event-db\n ::set-model-id\n (fn [db [_ model-id]]\n   (assoc-in db (db/key-seq :selected-model :model-id) model-id)))\n\n(reg-event-fx\n :slurp-model-data-json\n [(inject-cofx ::model-data-json-parsed)]\n (fn [{:keys [db model-data-json-parsed]} _]\n   {:db (let [all-models (get db (db/key-seq :all-models))]\n          (if (or (= db/loading-text all-models) (nil? all-models))\n            (assoc-in db (db/key-seq :all-models) model-data-json-parsed)\n            (do (log :warn \"Attempted to slurp and parse model data json, but the db already contained data:\" all-models)\n                db)))}))\n"]}